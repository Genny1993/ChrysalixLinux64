#pragma once

#include "Machine.h"

const unsigned char STRICTED = 0;	//Только определенно количество параметров
const unsigned char MINIMAL = 1;	//Минимальное количество параметров
const unsigned char RANGE = 3;		//Параметры от минимального до максимального
const unsigned char VARIANTS = 4;	//Варианты количества параметров

//Хелперы поиска данных

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// getValue 
// Возвращает значение параметра по имени переменной или литералу
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Var getValue(Var* val,std::unordered_map<std::wstring, Var>* heap, Machine *m);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// getLabel
// Возвращает значение параметра по имени переменной или литералу
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Var getLabel(Var* val,std::unordered_map<std::wstring, int>* pointers);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  setValue 
// Возвращает переменную для присваивания
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Var& setValue(Var* val,std::unordered_map<std::wstring, Var>* heap, Machine* m);

//Хелперы валидации инструкций

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// checkExistValue
// Проверяет существование переменной
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void checkExistValue(Var* val, Machine* m);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// checkNotExistValue
// Проверяет отсутствие существования переменной
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void checkNotExistValue(Var* val, Machine* m);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// checkExistLabel
// Проверяет существование метки
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void checkExistLabel(Var* val, Machine* m);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// checkParameterCount
// Проверяет соответствие количества инструкций
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void checkParameterCount(unsigned char type, int count, std::wstring* name, int stricted = 0, int min = 0, int range[] = nullptr, int variant[] = nullptr, int size_variants = 0);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// requiredVar
// Проверяет то, что требуется переменная
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void requiredVar(Var* val, std::wstring* type, std::wstring num);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// requiredLabel
// Проверяет то, что требуется метка
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void requiredLabel(Var* val, std::wstring* type, std::wstring num);

void validateInstruction(Instruction& inst, Machine *m, bool nested = false);

//Хелперы кодировки
std::wstring loadFile(std::wstring filename);
int Unicode();